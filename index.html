<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lily & Rue's Chores Chart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.5s ease;
        }

        /* Monday - Banksy street art graffiti style */
        body.day-1 {
            background: 
                linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(40,40,40,0.7) 100%),
                repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,0,100,0.1) 20px, rgba(255,0,100,0.1) 40px),
                linear-gradient(to bottom, #1a1a1a 0%, #2d2d2d 100%);
            color: #f0f0f0;
        }

        /* Tuesday - Monet water lilies impressionist */
        body.day-2 {
            background:
                radial-gradient(ellipse at 30% 40%, rgba(147,197,253,0.3), transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(196,181,253,0.3), transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(134,239,172,0.2), transparent 40%),
                linear-gradient(135deg, #7dd3fc 0%, #a78bfa 50%, #86efac 100%);
            color: #1a1a1a;
        }

        /* Wednesday - Picasso cubism geometric */
        body.day-3 {
            background:
                conic-gradient(from 45deg at 20% 30%, #fb923c 0deg, #fb923c 90deg, transparent 90deg, transparent 180deg, #3b82f6 180deg, #3b82f6 270deg, transparent 270deg),
                conic-gradient(from 135deg at 80% 70%, #ec4899 0deg, #ec4899 90deg, transparent 90deg, transparent 180deg, #8b5cf6 180deg, #8b5cf6 270deg, transparent 270deg),
                linear-gradient(45deg, #fb923c 0%, #3b82f6 50%, #ec4899 100%);
            color: #1a1a1a;
        }

        /* Thursday - Street art bold colors */
        body.day-4 {
            background:
                repeating-linear-gradient(90deg, transparent, transparent 60px, rgba(255,255,255,0.1) 60px, rgba(255,255,255,0.1) 120px),
                repeating-linear-gradient(0deg, transparent, transparent 60px, rgba(0,0,0,0.1) 60px, rgba(0,0,0,0.1) 120px),
                linear-gradient(135deg, #f59e0b 0%, #ef4444 50%, #8b5cf6 100%);
            color: #1a1a1a;
        }

        /* Friday - Monet sunrise palette */
        body.day-5 {
            background:
                radial-gradient(circle at 80% 20%, rgba(251,191,36,0.4), transparent 30%),
                radial-gradient(circle at 60% 30%, rgba(251,146,60,0.3), transparent 25%),
                radial-gradient(circle at 70% 25%, rgba(252,165,165,0.3), transparent 20%),
                linear-gradient(to bottom, #fbbf24 0%, #fb923c 30%, #fca5a5 60%, #7dd3fc 100%);
            color: #1a1a1a;
        }

        /* Saturday - Banksy stencil art */
        body.day-6 {
            background:
                repeating-conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(255,255,255,0.05) 30deg, transparent 60deg),
                linear-gradient(135deg, #18181b 0%, #3f3f46 50%, #52525b 100%);
            color: #f0f0f0;
        }

        /* Sunday - Street art vibrant splatter */
        body.day-0 {
            background:
                radial-gradient(circle at 20% 30%, rgba(236,72,153,0.3), transparent 20%),
                radial-gradient(circle at 80% 40%, rgba(59,130,246,0.3), transparent 25%),
                radial-gradient(circle at 50% 70%, rgba(34,197,94,0.3), transparent 20%),
                radial-gradient(circle at 30% 80%, rgba(251,146,60,0.3), transparent 18%),
                radial-gradient(circle at 70% 85%, rgba(168,85,247,0.3), transparent 22%),
                linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #f0f0f0;
        }

        .container {
            max-width: 100%;
            padding: 12px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        body.day-1 .header,
        body.day-6 .header,
        body.day-0 .header {
            background: rgba(40,40,40,0.95);
            color: #f0f0f0;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 1px;
        }

        .star-display {
            font-size: 2rem;
            font-weight: bold;
            color: #fbbf24;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .tab-btn {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            color: #1a1a1a;
            border: 3px solid transparent;
            padding: 12px 35px;
            font-size: 1.5rem;
            font-weight: 900;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.day-1 .tab-btn,
        body.day-6 .tab-btn,
        body.day-0 .tab-btn {
            background: rgba(60,60,60,0.9);
            color: #f0f0f0;
        }

        .tab-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .tab-btn.active {
            border-color: #ef4444;
            background: rgba(239,68,68,0.9);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        .day-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        body.day-1 .day-section,
        body.day-6 .day-section,
        body.day-0 .day-section {
            background: rgba(40,40,40,0.95);
            color: #f0f0f0;
        }

        .day-header {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 3px solid #ef4444;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .time-section {
            margin-bottom: 15px;
        }

        .time-label {
            font-size: 1.3rem;
            font-weight: 800;
            color: #ef4444;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
        }

        .task-item {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.day-1 .task-item,
        body.day-6 .task-item,
        body.day-0 .task-item {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            color: #f0f0f0;
        }

        .task-item:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border-color: #ef4444;
        }

        .task-item.completed {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            text-decoration: line-through;
            opacity: 0.7;
        }

        body.day-1 .task-item.completed,
        body.day-6 .task-item.completed,
        body.day-0 .task-item.completed {
            background: linear-gradient(135deg, #166534 0%, #15803d 100%);
        }

        .task-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .task-check {
            margin-left: auto;
            font-size: 1.2rem;
            color: #22c55e;
        }

        .rewards-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        body.day-1 .rewards-section,
        body.day-6 .rewards-section,
        body.day-0 .rewards-section {
            background: rgba(40,40,40,0.95);
            color: #f0f0f0;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ef4444;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }

        .reward-item {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #fbbf24;
        }

        body.day-1 .reward-item,
        body.day-6 .reward-item,
        body.day-0 .reward-item {
            background: linear-gradient(135deg, #713f12 0%, #854d0e 100%);
            border-color: #fbbf24;
            color: #fef3c7;
        }

        .reward-cost {
            font-size: 1.4rem;
            color: #f59e0b;
            font-weight: 900;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }

        .event-item {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 12px;
            border-radius: 10px;
            border-left: 5px solid #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.day-1 .event-item,
        body.day-6 .event-item,
        body.day-0 .event-item {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%);
            color: #dbeafe;
            border-left-color: #60a5fa;
        }

        .event-date {
            font-weight: 900;
            color: #3b82f6;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        body.day-1 .event-date,
        body.day-6 .event-date,
        body.day-0 .event-date {
            color: #93c5fd;
        }

        .event-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .controls {
            text-align: center;
            padding: 15px;
        }

        .btn {
            background: rgba(239,68,68,0.9);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.3rem;
            font-weight: 900;
            border-radius: 10px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal h2 {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 20px;
            color: #ef4444;
            text-transform: uppercase;
        }

        .modal input,
        .modal textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            font-size: 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
        }

        .modal input:focus,
        .modal textarea:focus {
            outline: none;
            border-color: #ef4444;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="day-1">
    <div class="container">
        <div class="header">
            <h1>üé® LILY & RUE'S CHORES üé®</h1>
            <div class="star-display" id="headerStars">‚≠ê 0</div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('lily')">LILY</button>
            <button class="tab-btn" onclick="switchTab('rue')">RUE</button>
            <button class="tab-btn" onclick="switchTab('calendar')">üìÖ CALENDAR</button>
        </div>

        <div id="lily-content" class="tab-content active">
            <div id="lilyChores"></div>
            <div class="rewards-section">
                <div class="section-title">üéÅ LILY'S REWARDS</div>
                <div class="rewards-grid" id="lilyRewards"></div>
            </div>
        </div>

        <div id="rue-content" class="tab-content">
            <div id="rueChores"></div>
            <div class="rewards-section">
                <div class="section-title">üéÅ RUE'S REWARDS</div>
                <div class="rewards-grid" id="rueRewards"></div>
            </div>
        </div>

        <div id="calendar-content" class="tab-content">
            <div class="rewards-section">
                <div class="section-title">üìÖ FAMILY CALENDAR</div>
                <div class="calendar-grid" id="calendarEvents"></div>
            </div>
            <div class="controls">
                <button class="btn" onclick="openEventModal()">‚ûï ADD EVENT</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="openEditModal()">‚úèÔ∏è EDIT CHORES</button>
            <button class="btn" onclick="openRewardModal()">üéÅ EDIT REWARDS</button>
            <button class="btn" onclick="resetWeek()">üîÑ RESET WEEK</button>
        </div>
    </div>

    <!-- Edit Chores Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>Edit <span id="editChildName"></span>'s Chores</h2>
            <p style="margin-bottom: 15px; font-weight: 600;">One task per line. Format: Task name ‚≠êstars</p>
            
            <label style="font-weight: 700; margin-top: 10px; display: block;">WEEKDAY MORNING:</label>
            <textarea id="weekdayMorning" rows="8"></textarea>
            
            <label style="font-weight: 700; margin-top: 10px; display: block;">WEEKDAY AFTERNOON:</label>
            <textarea id="weekdayAfternoon" rows="5"></textarea>
            
            <label style="font-weight: 700; margin-top: 10px; display: block;">WEEKEND MORNING:</label>
            <textarea id="weekendMorning" rows="6"></textarea>
            
            <label style="font-weight: 700; margin-top: 10px; display: block;">WEEKEND AFTERNOON:</label>
            <textarea id="weekendAfternoon" rows="5"></textarea>
            
            <button class="btn" onclick="saveChoreChanges()">SAVE</button>
            <button class="btn" onclick="closeModal('editModal')" style="background: #6b7280;">CANCEL</button>
        </div>
    </div>

    <!-- Edit Rewards Modal -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <h2>Edit Rewards</h2>
            <label style="font-weight: 700; display: block; margin-bottom: 10px;">LILY'S REWARDS (format: Reward ‚≠êcost):</label>
            <textarea id="lilyRewardsInput" rows="6"></textarea>
            
            <label style="font-weight: 700; display: block; margin: 15px 0 10px;">RUE'S REWARDS:</label>
            <textarea id="rueRewardsInput" rows="6"></textarea>
            
            <button class="btn" onclick="saveRewardChanges()">SAVE</button>
            <button class="btn" onclick="closeModal('rewardModal')" style="background: #6b7280;">CANCEL</button>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <h2>Add Family Event</h2>
            <input type="date" id="eventDate">
            <input type="text" id="eventTitle" placeholder="Event name">
            <input type="text" id="eventDetails" placeholder="Time/Details (optional)">
            <button class="btn" onclick="saveEvent()">ADD EVENT</button>
            <button class="btn" onclick="closeModal('eventModal')" style="background: #6b7280;">CANCEL</button>
        </div>
    </div>

    <script>
        const weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        const weekendDays = ['Saturday', 'Sunday'];
        let currentTab = 'lily';
        let editingChild = 'lily';

        const taskIcons = {
            'toilet': 'üöΩ', 'eat': 'üçΩÔ∏è', 'breakfast': 'ü•ê', 'brush teeth': 'ü™•', 
            'teeth': 'ü™•', 'dressed': 'üëï', 'get dressed': 'üëï', 'hair': 'üíá',
            'brush hair': 'üíá', 'feed': 'üêæ', 'animals': 'üêæ', 'lunchbox': 'üç±',
            'pack lunchbox': 'üç±', 'bag': 'üéí', 'pack bag': 'üéí', 'unpack bag': 'üéí',
            'unpack': 'üì¶', 'tidy': 'üßπ', 'room': 'üõèÔ∏è', 'tidy room': 'üßπ',
            'dishwasher': 'üçΩÔ∏è', 'dishes': 'üçΩÔ∏è'
        };

        function getIcon(taskName) {
            const lower = taskName.toLowerCase();
            for (let key in taskIcons) {
                if (lower.includes(key)) return taskIcons[key];
            }
            return '‚ú®';
        }

        let data = {
            lily: {
                stars: 0,
                weekdayMorning: [
                    'Eat breakfast ‚≠ê1', 'Brush teeth ‚≠ê1', 'Get dressed ‚≠ê1',
                    'Brush hair ‚≠ê1', 'Feed animals ‚≠ê2', 'Pack lunchbox ‚≠ê1',
                    'Pack bag ‚≠ê1'
                ],
                weekdayAfternoon: [
                    'Unpack bag ‚≠ê1', 'Tidy room ‚≠ê2', 'Unpack dishwasher ‚≠ê2',
                    'Feed animals ‚≠ê2'
                ],
                weekendMorning: [
                    'Eat breakfast ‚≠ê1', 'Brush teeth ‚≠ê1', 'Get dressed ‚≠ê1',
                    'Brush hair ‚≠ê1', 'Feed animals ‚≠ê2'
                ],
                weekendAfternoon: [
                    'Tidy room ‚≠ê2', 'Unpack dishwasher ‚≠ê2', 'Feed animals ‚≠ê2'
                ],
                completed: {
                    Monday: { morning: [], afternoon: [] },
                    Tuesday: { morning: [], afternoon: [] },
                    Wednesday: { morning: [], afternoon: [] },
                    Thursday: { morning: [], afternoon: [] },
                    Friday: { morning: [], afternoon: [] },
                    Saturday: { morning: [], afternoon: [] },
                    Sunday: { morning: [], afternoon: [] }
                },
                rewards: [
                    '30 min screen time ‚≠ê5',
                    'Choose dinner ‚≠ê10',
                    'Movie pick ‚≠ê15',
                    'Special treat ‚≠ê20'
                ]
            },
            rue: {
                stars: 0,
                weekdayMorning: [
                    'Toilet ‚≠ê1', 'Eat breakfast ‚≠ê1', 'Brush teeth ‚≠ê1',
                    'Get dressed ‚≠ê1', 'Brush hair ‚≠ê1', 'Feed animals ‚≠ê2',
                    'Pack lunchbox ‚≠ê1', 'Pack bag ‚≠ê1'
                ],
                weekdayAfternoon: [
                    'Unpack bag ‚≠ê1', 'Tidy room ‚≠ê2', 'Unpack dishwasher ‚≠ê2',
                    'Feed animals ‚≠ê2'
                ],
                weekendMorning: [
                    'Toilet ‚≠ê1', 'Eat breakfast ‚≠ê1', 'Brush teeth ‚≠ê1',
                    'Get dressed ‚≠ê1', 'Brush hair ‚≠ê1', 'Feed animals ‚≠ê2'
                ],
                weekendAfternoon: [
                    'Tidy room ‚≠ê2', 'Unpack dishwasher ‚≠ê2', 'Feed animals ‚≠ê2'
                ],
                completed: {
                    Monday: { morning: [], afternoon: [] },
                    Tuesday: { morning: [], afternoon: [] },
                    Wednesday: { morning: [], afternoon: [] },
                    Thursday: { morning: [], afternoon: [] },
                    Friday: { morning: [], afternoon: [] },
                    Saturday: { morning: [], afternoon: [] },
                    Sunday: { morning: [], afternoon: [] }
                },
                rewards: [
                    'Extra story ‚≠ê5',
                    'Park trip ‚≠ê10',
                    'Ice cream ‚≠ê12',
                    'Special outing ‚≠ê20'
                ]
            },
            events: []
        };

        function getDayOfWeek() {
            return new Date().getDay();
        }

        function updateBackground() {
            document.body.className = 'day-' + getDayOfWeek();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab !== 'calendar') {
                updateHeaderStars();
            }
        }

        function updateHeaderStars() {
            const child = data[currentTab];
            document.getElementById('headerStars').textContent = `‚≠ê ${child.stars}`;
        }

        function parseTask(taskStr) {
            const match = taskStr.match(/(.+?)\s*‚≠ê(\d+)/);
            if (match) {
                return { name: match[1].trim(), stars: parseInt(match[2]) };
            }
            return { name: taskStr.trim(), stars: 1 };
        }

        function renderChild(childName) {
            const child = data[childName];
            const container = document.getElementById(childName + 'Chores');
            
            let html = '';
            const allDays = [...weekdays, ...weekendDays];
            
            allDays.forEach(day => {
                const isWeekend = weekendDays.includes(day);
                const morningTasks = isWeekend ? child.weekendMorning : child.weekdayMorning;
                const afternoonTasks = isWeekend ? child.weekendAfternoon : child.weekdayAfternoon;
                
                html += `<div class="day-section">
                    <div class="day-header">${day}</div>
                    <div class="time-section">
                        <div class="time-label">‚òÄÔ∏è MORNING</div>
                        <div class="tasks-grid">`;
                
                morningTasks.forEach((taskStr, idx) => {
                    const task = parseTask(taskStr);
                    const isCompleted = child.completed[day].morning.includes(idx);
                    html += `
                        <div class="task-item ${isCompleted ? 'completed' : ''}" 
                             onclick="toggleTask('${childName}', '${day}', 'morning', ${idx})">
                            <span class="task-icon">${getIcon(task.name)}</span>
                            <span>${task.name}</span>
                            ${isCompleted ? '<span class="task-check">‚úì</span>' : ''}
                        </div>`;
                });
                
                html += `</div></div><div class="time-section">
                    <div class="time-label">üåô AFTERNOON</div>
                    <div class="tasks-grid">`;
                
                afternoonTasks.forEach((taskStr, idx) => {
                    const task = parseTask(taskStr);
                    const isCompleted = child.completed[day].afternoon.includes(idx);
                    html += `
                        <div class="task-item ${isCompleted ? 'completed' : ''}" 
                             onclick="toggleTask('${childName}', '${day}', 'afternoon', ${idx})">
                            <span class="task-icon">${getIcon(task.name)}</span>
                            <span>${task.name}</span>
                            ${isCompleted ? '<span class="task-check">‚úì</span>' : ''}
                        </div>`;
                });
                
                html += `</div></div></div>`;
            });
            
            container.innerHTML = html;
        }

        function toggleTask(childName, day, timeOfDay, taskIdx) {
            const child = data[childName];
            const completed = child.completed[day][timeOfDay];
            const taskList = weekendDays.includes(day) ? 
                (timeOfDay === 'morning' ? child.weekendMorning : child.weekendAfternoon) :
                (timeOfDay === 'morning' ? child.weekdayMorning : child.weekdayAfternoon);
            
            const task = parseTask(taskList[taskIdx]);
            const idx = completed.indexOf(taskIdx);
            
            if (idx > -1) {
                completed.splice(idx, 1);
                child.stars -= task.stars;
            } else {
                completed.push(taskIdx);
                child.stars += task.stars;
            }
            
            save();
            renderChild(childName);
            renderRewards(childName);
            updateHeaderStars();
        }

        function renderRewards(childName) {
            const child = data[childName];
            const container = document.getElementById(childName + 'Rewards');
            
            let html = '';
            child.rewards.forEach(rewardStr => {
                const match = rewardStr.match(/(.+?)\s*‚≠ê(\d+)/);
                const name = match ? match[1].trim() : rewardStr;
                const cost = match ? match[2] : '5';
                html += `
                    <div class="reward-item">
                        <span>${name}</span>
                        <span class="reward-cost">‚≠ê${cost}</span>
                    </div>`;
            });
            
            container.innerHTML = html;
        }

        function renderCalendar() {
            const container = document.getElementById('calendarEvents');
            
            if (data.events.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 30px; font-size: 1.3rem;">No events scheduled</p>';
                return;
            }
            
            data.events.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let html = '';
            data.events.forEach((event, idx) => {
                const date = new Date(event.date);
                const formatted = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                html += `
                    <div class="event-item" onclick="deleteEvent(${idx})">
                        <div class="event-date">${formatted}</div>
                        <div class="event-title">${event.title}</div>
                        ${event.details ? `<div style="margin-top: 5px; opacity: 0.8;">${event.details}</div>` : ''}
                    </div>`;
            });
            
            container.innerHTML = html;
        }

        function openEditModal() {
            editingChild = currentTab === 'calendar' ? 'lily' : currentTab;
            const child = data[editingChild];
            
            document.getElementById('editChildName').textContent = editingChild.toUpperCase();
            document.getElementById('weekdayMorning').value = child.weekdayMorning.join('\n');
            document.getElementById('weekdayAfternoon').value = child.weekdayAfternoon.join('\n');
            document.getElementById('weekendMorning').value = child.weekendMorning.join('\n');
            document.getElementById('weekendAfternoon').value = child.weekendAfternoon.join('\n');
            
            document.getElementById('editModal').style.display = 'flex';
        }

        function saveChoreChanges() {
            const child = data[editingChild];
            
            child.weekdayMorning = document.getElementById('weekdayMorning').value.split('\n').filter(l => l.trim());
            child.weekdayAfternoon = document.getElementById('weekdayAfternoon').value.split('\n').filter(l => l.trim());
            child.weekendMorning = document.getElementById('weekendMorning').value.split('\n').filter(l => l.trim());
            child.weekendAfternoon = document.getElementById('weekendAfternoon').value.split('\n').filter(l => l.trim());
            
            // Reset completed tasks
            Object.keys(child.completed).forEach(day => {
                child.completed[day] = { morning: [], afternoon: [] };
            });
            
            save();
            renderChild(editingChild);
            closeModal('editModal');
        }

        function openRewardModal() {
            document.getElementById('lilyRewardsInput').value = data.lily.rewards.join('\n');
            document.getElementById('rueRewardsInput').value = data.rue.rewards.join('\n');
            document.getElementById('rewardModal').style.display = 'flex';
        }

        function saveRewardChanges() {
            data.lily.rewards = document.getElementById('lilyRewardsInput').value.split('\n').filter(l => l.trim());
            data.rue.rewards = document.getElementById('rueRewardsInput').value.split('\n').filter(l => l.trim());
            
            save();
            renderRewards('lily');
            renderRewards('rue');
            closeModal('rewardModal');
        }

        function openEventModal() {
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDetails').value = '';
            document.getElementById('eventModal').style.display = 'flex';
        }

        function saveEvent() {
            const date = document.getElementById('eventDate').value;
            const title = document.getElementById('eventTitle').value;
            const details = document.getElementById('eventDetails').value;
            
            if (!date || !title) {
                alert('Please enter a date and event name');
                return;
            }
            
            data.events.push({ date, title, details });
            save();
            renderCalendar();
            closeModal('eventModal');
        }

        function deleteEvent(idx) {
            if (confirm('Delete this event?')) {
                data.events.splice(idx, 1);
                save();
                renderCalendar();
            }
        }

        function resetWeek() {
            if (confirm('Reset all tasks for the week? Stars will be kept.')) {
                ['lily', 'rue'].forEach(child => {
                    Object.keys(data[child].completed).forEach(day => {
                        data[child].completed[day] = { morning: [], afternoon: [] };
                    });
                });
                save();
                renderChild('lily');
                renderChild('rue');
            }
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function save() {
            localStorage.setItem('lilyRueChores', JSON.stringify(data));
        }

        function load() {
            const saved = localStorage.getItem('lilyRueChores');
            if (saved) {
                data = JSON.parse(saved);
            }
        }

        // Initialize
        load();
        updateBackground();
        renderChild('lily');
        renderChild('rue');
        renderRewards('lily');
        renderRewards('rue');
        renderCalendar();
        updateHeaderStars();
        
        setInterval(save, 30000);
        
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>